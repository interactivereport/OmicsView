// https://d3js.org/d3-zoom/ Version 1.0.3. Copyright 2016 Mike Bostock.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,n,o,i,u){"use strict";function r(t){return function(){return t}}function h(t,e,n){this.target=t,this.type=e,this.transform=n}function s(t,e,n){this.k=t,this.x=e,this.y=n}function c(t){return t.__zoom||v}function a(){i.event.stopImmediatePropagation()}function f(){i.event.preventDefault(),i.event.stopImmediatePropagation()}function l(){return!i.event.button}function m(){var t,e,n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,t=n.width.baseVal.value,e=n.height.baseVal.value):(t=n.clientWidth,e=n.clientHeight),[[0,0],[t,e]]}function p(){return this.__zoom||v}function d(){function t(t){t.on(Z+".zoom",x).on("mousedown.zoom",k).on("dblclick.zoom",w).on("touchstart.zoom",M).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",b).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",p)}function c(t,e){return e=Math.max(V,Math.min(D,e)),e===t.k?t:new s(e,t.x,t.y)}function d(t,e,n){var o=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return o===t.x&&i===t.y?t:new s(t.k,o,i)}function v(t,e){var n=t.invertX(e[0][0])-I,o=t.invertX(e[1][0])-P,i=t.invertY(e[0][1])-S,u=t.invertY(e[1][1])-j;return t.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),u>i?(i+u)/2:Math.min(0,i)||Math.max(0,u))}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function z(t,e,n){t.on("start.zoom",function(){_(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).end()}).tween("zoom",function(){var t=this,o=arguments,i=_(t,o),u=X.apply(t,o),r=n||y(u),h=Math.max(u[1][0]-u[0][0],u[1][1]-u[0][1]),c=t.__zoom,a="function"==typeof e?e.apply(t,o):e,f=G(c.invert(r).concat(h/c.k),a.invert(r).concat(h/a.k));return function(t){if(1===t)t=a;else{var e=f(t),n=h/e[2];t=new s(n,r[0]-e[0]*n,r[1]-e[1]*n)}i.zoom(null,t)}})}function _(t,e){for(var n,o=0,i=H.length;o<i;++o)if((n=H[o]).that===t)return n;return new g(t,e)}function g(t,e){this.that=t,this.args=e,this.index=-1,this.active=0,this.extent=X.apply(t,e)}function x(){function t(){e.wheel=null,e.end()}if(E.apply(this,arguments)){var e=_(this,arguments),n=this.__zoom,o="wheel"==Z?-i.event.deltaY:i.event.wheelDeltaY,r=Math.max(V,Math.min(D,n.k*Math.pow(2,o*(i.event.deltaMode?120:1)/500))),h=i.mouse(this);if(e.wheel)e.mouse[0][0]===h[0]&&e.mouse[0][1]===h[1]||(e.mouse[1]=n.invert(e.mouse[0]=h)),clearTimeout(e.wheel);else{if(n.k===r)return;e.mouse=[h,n.invert(h)],u.interrupt(this),e.start()}f(),e.wheel=setTimeout(t,W),e.zoom("mouse",v(d(c(n,r),e.mouse[0],e.mouse[1]),e.extent))}}function k(){function t(){f(),o.moved=!0,o.zoom("mouse",v(d(o.that.__zoom,o.mouse[0]=i.mouse(o.that),o.mouse[1]),o.extent))}function e(){r.on("mousemove.zoom mouseup.zoom",null),n.dragEnable(i.event.view,o.moved),f(),o.end()}if(!q&&E.apply(this,arguments)){var o=_(this,arguments),r=i.select(i.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",e,!0),h=i.mouse(this);n.dragDisable(i.event.view),a(),o.mouse=[h,this.__zoom.invert(h)],u.interrupt(this),o.start()}}function w(){if(E.apply(this,arguments)){var e=this.__zoom,n=i.mouse(this),o=e.invert(n),u=e.k*(i.event.shiftKey?.5:2),r=v(d(c(e,u),n,o),X.apply(this,arguments));f(),B>0?i.select(this).transition().duration(B).call(z,r,n):i.select(this).call(t.transform,r)}}function M(){if(E.apply(this,arguments)){var t,e,n,o=_(this,arguments),r=i.event.changedTouches,h=r.length;for(a(),t=0;t<h;++t)e=r[t],n=i.touch(this,r,e.identifier),n=[n,this.__zoom.invert(n),e.identifier],o.touch0?o.touch1||(o.touch1=n):o.touch0=n;return Y&&(Y=clearTimeout(Y),!o.touch1)?(o.end(),n=i.select(this).on("dblclick.zoom"),void(n&&n.apply(this,arguments))):void(i.event.touches.length===h&&(Y=setTimeout(function(){Y=null},O),u.interrupt(this),o.start()))}}function T(){var t,e,n,o,u=_(this,arguments),r=i.event.changedTouches,h=r.length;for(f(),Y&&(Y=clearTimeout(Y)),t=0;t<h;++t)e=r[t],n=i.touch(this,r,e.identifier),u.touch0&&u.touch0[2]===e.identifier?u.touch0[0]=n:u.touch1&&u.touch1[2]===e.identifier&&(u.touch1[0]=n);if(e=u.that.__zoom,u.touch1){var s=u.touch0[0],a=u.touch0[1],l=u.touch1[0],m=u.touch1[1],p=(p=l[0]-s[0])*p+(p=l[1]-s[1])*p,y=(y=m[0]-a[0])*y+(y=m[1]-a[1])*y;e=c(e,Math.sqrt(p/y)),n=[(s[0]+l[0])/2,(s[1]+l[1])/2],o=[(a[0]+m[0])/2,(a[1]+m[1])/2]}else{if(!u.touch0)return;n=u.touch0[0],o=u.touch0[1]}u.zoom("touch",v(d(e,n,o),u.extent))}function b(){var t,e,n=_(this,arguments),o=i.event.changedTouches,u=o.length;for(a(),q&&clearTimeout(q),q=setTimeout(function(){q=null},O),t=0;t<u;++t)e=o[t],n.touch0&&n.touch0[2]===e.identifier?delete n.touch0:n.touch1&&n.touch1[2]===e.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0||n.end()}var Y,q,E=l,X=m,V=0,D=1/0,I=-D,P=D,S=I,j=P,B=250,G=o.interpolateZoom,H=[],K=e.dispatch("start","zoom","end"),O=500,W=150,Z=void 0!==document.onmousewheel?"mousewheel":"wheel";return t.transform=function(t,e){var n=t.selection?t.selection():t;n.property("__zoom",p),t!==n?z(t,e):n.interrupt().each(function(){_(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()})},t.scaleBy=function(e,n){t.scaleTo(e,function(){var t=this.__zoom.k,e="function"==typeof n?n.apply(this,arguments):n;return t*e})},t.scaleTo=function(e,n){t.transform(e,function(){var t=X.apply(this,arguments),e=this.__zoom,o=y(t),i=e.invert(o),u="function"==typeof n?n.apply(this,arguments):n;return v(d(c(e,u),o,i),t)})},t.translateBy=function(e,n,o){t.transform(e,function(){return v(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof o?o.apply(this,arguments):o),X.apply(this,arguments))})},g.prototype={start:function(){return 1===++this.active&&(this.index=H.push(this)-1,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0===--this.active&&(H.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(e){i.customEvent(new h(t,e,this.that.__zoom),K.apply,K,[e,this.that,this.args])}},t.filter=function(e){return arguments.length?(E="function"==typeof e?e:r(!!e),t):E},t.extent=function(e){return arguments.length?(X="function"==typeof e?e:r([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),t):X},t.scaleExtent=function(e){return arguments.length?(V=+e[0],D=+e[1],t):[V,D]},t.translateExtent=function(e){return arguments.length?(I=+e[0][0],P=+e[1][0],S=+e[0][1],j=+e[1][1],t):[[I,S],[P,j]]},t.duration=function(e){return arguments.length?(B=+e,t):B},t.interpolate=function(e){return arguments.length?(G=e,t):G},t.on=function(){var e=K.on.apply(K,arguments);return e===K?t:e},t}s.prototype={constructor:s,scale:function(t){return 1===t?this:new s(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new s(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var v=new s(1,0,0);c.prototype=s.prototype,t.zoom=d,t.zoomTransform=c,t.zoomIdentity=v,Object.defineProperty(t,"__esModule",{value:!0})});