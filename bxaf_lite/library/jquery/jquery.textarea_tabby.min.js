!function(t){function e(t,e,r){var l=t.scrollTop;t.setSelectionRange?n(t,e,r):document.selection&&a(t,e,r),t.scrollTop=l}function n(t,e,n){var a=t.selectionStart,r=t.selectionEnd;if(a==r)e?"	"==t.value.substring(a-n.tabString.length,a)?(t.value=t.value.substring(0,a-n.tabString.length)+t.value.substring(a),t.focus(),t.setSelectionRange(a-n.tabString.length,a-n.tabString.length)):"	"==t.value.substring(a,a+n.tabString.length)&&(t.value=t.value.substring(0,a)+t.value.substring(a+n.tabString.length),t.focus(),t.setSelectionRange(a,a)):(t.value=t.value.substring(0,a)+n.tabString+t.value.substring(a),t.focus(),t.setSelectionRange(a+n.tabString.length,a+n.tabString.length));else{var l=t.value.split("\n"),g=new Array,s=0,i=0;for(var b in l)i=s+l[b].length,g.push({start:s,end:i,selected:a>=s&&i>a||i>=r&&r>s||s>a&&r>i}),s=i+1;var o=0;for(var b in g)if(g[b].selected){var u=g[b].start+o;e&&n.tabString==t.value.substring(u,u+n.tabString.length)?(t.value=t.value.substring(0,u)+t.value.substring(u+n.tabString.length),o-=n.tabString.length):e||(t.value=t.value.substring(0,u)+n.tabString+t.value.substring(u),o+=n.tabString.length)}t.focus();var c=a+(o>0?n.tabString.length:0>o?-n.tabString.length:0),h=r+o;t.setSelectionRange(c,h)}}function a(e,n,a){var r=document.selection.createRange();if(e==r.parentElement())if(""==r.text)if(n){var l=r.getBookmark();r.moveStart("character",-a.tabString.length),a.tabString==r.text?r.text="":(r.moveToBookmark(l),r.moveEnd("character",a.tabString.length),a.tabString==r.text&&(r.text="")),r.collapse(!0),r.select()}else r.text=a.tabString,r.collapse(!1),r.select();else{var g=r.text,s=g.length,i=g.split("\r\n"),b=document.body.createTextRange();b.moveToElementText(e),b.setEndPoint("EndToStart",r);var o=b.text,u=o.split("\r\n"),c=o.length,h=document.body.createTextRange();h.moveToElementText(e),h.setEndPoint("StartToEnd",r);var S=h.text,d=document.body.createTextRange();d.moveToElementText(e),d.setEndPoint("StartToEnd",b);var v=d.text,f=t(e).html();t("#r3").text(c+" + "+s+" + "+S.length+" = "+f.length),c+v.length<f.length?(u.push(""),c+=2,n&&a.tabString==i[0].substring(0,a.tabString.length)?i[0]=i[0].substring(a.tabString.length):n||(i[0]=a.tabString+i[0])):n&&a.tabString==u[u.length-1].substring(0,a.tabString.length)?u[u.length-1]=u[u.length-1].substring(a.tabString.length):n||(u[u.length-1]=a.tabString+u[u.length-1]);for(var m=1;m<i.length;m++)n&&a.tabString==i[m].substring(0,a.tabString.length)?i[m]=i[m].substring(a.tabString.length):n||(i[m]=a.tabString+i[m]);1==u.length&&0==c&&(n&&a.tabString==i[0].substring(0,a.tabString.length)?i[0]=i[0].substring(a.tabString.length):n||(i[0]=a.tabString+i[0])),c+s+S.length<f.length&&(i.push(""),s+=2),b.text=u.join("\r\n"),r.text=i.join("\r\n");var T=document.body.createTextRange();T.moveToElementText(e),c>0?T.setEndPoint("StartToEnd",b):T.setEndPoint("StartToStart",b),T.setEndPoint("EndToEnd",r),T.select()}}t.fn.tabby=function(n){var a=t.extend({},t.fn.tabby.defaults,n),r=t.fn.tabby.pressed;return this.each(function(){$this=t(this);var n=t.meta?t.extend({},a,$this.data()):a;$this.bind("keydown",function(a){var l=t.fn.tabby.catch_kc(a);return 16==l&&(r.shft=!0),17==l&&(r.ctrl=!0,setTimeout("$.fn.tabby.pressed.ctrl = false;",1e3)),18==l&&(r.alt=!0,setTimeout("$.fn.tabby.pressed.alt = false;",1e3)),9!=l||r.ctrl||r.alt?void 0:(a.preventDefault,r.last=l,setTimeout("$.fn.tabby.pressed.last = null;",0),e(t(a.target).get(0),r.shft,n),!1)}).bind("keyup",function(e){16==t.fn.tabby.catch_kc(e)&&(r.shft=!1)}).bind("blur",function(e){9==r.last&&t(e.target).one("focus",function(t){r.last=null}).get(0).focus()})})},t.fn.tabby.catch_kc=function(t){return t.keyCode?t.keyCode:t.charCode?t.charCode:t.which},t.fn.tabby.pressed={shft:!1,ctrl:!1,alt:!1,last:null},t.fn.tabby.defaults={tabString:String.fromCharCode(9)}}(jQuery);